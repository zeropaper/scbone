/*! scbone - v0.0.1 - 2013-11-13 */
!function(a){"object"==typeof exports?module.exports=a(require("underscore")):"function"==typeof define&&define.amd?define("templates",["underscore"],a):"function"!=typeof _&&(window.JST=a(_))}(function(_){var a={};return a["SCBone/profile"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="block-h">','<a href="<%- prefix %>host" class="picture">','<img src="<%- host.avatar_url %>" alt="<%- host.username %>" />',"</a>",'<div class="info">','<a href="<%- prefix %>host" class="username"><%- host.username %></a>','<span class="full-name"><%- host.full_name %></span>','<span class="city"><%- host.city %></span><%= (host.country && host.city ? "," : "") %>','<span class="country"><%- host.country %></span>',"</div>","</div>",'<ul class="subresources">',"<li>",'<%= (host.public_favorites_count ? "<a href=\\""+ prefix +"host/favorites\\">" : "<div>") %>','<i class="icon-heart"></i>','<span><%- (host.public_favorites_count || "") %></span>',"Likes",'<%= (host.public_favorites_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.track_count ? "<a href=\\""+ prefix +"host/tracks\\">" : "<div>") %>','<i class="icon-mic"></i>',"<span><%- (host.track_count || 0) %></span>","Tracks",'<%= (host.track_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.followings_count ? "<a href=\\""+ prefix +"host/followings\\">" : "<div>") %>','<i class="icon-angle-left"></i>',"<span><%- (host.followings_count || 0) %></span>","Followings",'<%= (host.followings_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.followers_count ? "<a href=\\""+ prefix +"host/followers\\">" : "<div>") %>','<i class="icon-angle-right"></i>',"<span><%- (host.followers_count || 0) %></span>","Followers",'<%= (host.followers_count ? "</a>" : "</div>") %>',"</li>","</ul>",'<div class="description"><%- host.description %></div>',""].join("\n")),a["SCBone/user"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="block-h">','<a href="<%- prefix %>users/<%- permalink %>" class="picture">','<img src="<%- avatar_url %>" alt="<%- username %>" />',"</a>",'<div class="info">','<a href="<%- prefix %>users/<%- permalink %>" class="username"><%- username %></a>','<span class="full-name"><%- full_name %></span>','<span class="city"><%- city %></span><%= (country && city ? "," : "") %>','<span class="country"><%- country %></span>',"</div>","</div>",'<ul class="subresources">',"<li>",'<%= (public_favorites_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/favorites\\">" : "<div>") %>','<i class="icon-heart"></i>','<span><%- (public_favorites_count || "") %></span>',"Likes",'<%= (public_favorites_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (track_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/tracks\\">" : "<div>") %>','<i class="icon-mic"></i>',"<span><%- (track_count || 0) %></span>","Tracks",'<%= (track_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (followings_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/followings\\">" : "<div>") %>','<i class="icon-angle-left"></i>',"<span><%- (followings_count || 0) %></span>","Followings",'<%= (followings_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (followers_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/followers\\">" : "<div>") %>','<i class="icon-angle-right"></i>',"<span><%- (followers_count || 0) %></span>","Followers",'<%= (followers_count ? "</a>" : "</div>") %>',"</li>","</ul>",'<div class="description"><%- description %></div>',""].join("\n")),a["SCBone/app"]=_.template(["",'<div class="host"></div>','<div class="scope player"></div>','<ol class="scope tracks"></ol>','<ol class="scope users"></ol>',""].join("\n")),a["SCBone/player"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="progress"></div>','<div class="controls"></div>','<div class="logos">','<a class="soundcloud" href="http://soundcloud.com" title="powered by Soundcloud"><img src="images/logo_big_white.png" alt="powered by Soundcloud" /></a>',"</div>",'<section class="list tracks"><ol></ol></section>',""].join("\n")),a["SCBone/controls"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="playback">','<button class="prev icon-prev"><i class="icon-angle-double-left"></i></button>','<button class="next icon-next"><i class="icon-angle-double-right"></i></button>',"</div>",""].join("\n")),a["SCBone/trackItem"]=_.template(["","<%",'var prefix = "#"+ (routePrefix ? routePrefix +"/" : "");','var likes = (typeof favoritings_count !== "undefined" ? favoritings_count : 0);','var user_liked = (typeof user_favorite !== "undefined" && user_favorite);','var removeable = (typeof removeable !== "undefined" && removeable);',"%>",'<li<%= (artwork_url ? "" : " class=\\"no-artwork\\"") %>>',"<% if(artwork_url) { %>",'<img class="artwork" src="<%- artwork_url %>">',"<% } %>",'<div class="track-info <%- sharing %>">','<div class="title">','<a href="<%- prefix %>tracks/<%- id %>"><%- title %></a>',"</div>",'<span class="duration">','<i class="icon-clock"></i>','<%- moment(duration).format("m:s") %>',"</span>",'<div class="actions"><% if (removeable) { %>','<i class="icon-minus" data-action="remove" data-id="<%- id %>"></i>',"<% } else { %>",'<i class="icon-plus" data-action="add" data-id="<%- id %>"></i>',"<% } %></div>",'<span class="likes" data-action="like" data-id="<%- id %>"','<%= (user_liked ? " title=\\"You liked it.\\"" : "") %>',">",'<i class="icon-heart<%- (user_liked ? "" : "-empty") %>"></i>',"<%- likes %>","</span>",'<a href="<%- prefix %>users/<%- user.permalink %>" class="username">',"<%- user.username %>","</a>",'<% if (sharing === "private") { %>',"<% } %>","</div>","</li>",""].join("\n")),a["SCBone/userItem"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<li<%= (artwork_url ? "" : " class=\\"no-artwork\\"") %>>',"<% if(artwork_url) { %>",'<img class="artwork" src="<%- artwork_url %>">',"<% } %>",'<div class="track-info">','<div class="title">','<a href="<%- prefix %>tracks/<%- id %>"><%- title %></a>',"</div>",'<span class="duration">','<i class="icon-clock"></i>','<%- moment(duration).format("m:s") %>',"</span>",'<% if(typeof favoritings_count !== "undefined") { %>','<span class="favorited"><%- favoritings_count %></span>',"<% } %>",'<a href="<%- prefix %>users/<%- user.permalink %>" class="username">',"<%- user.username %>","</a>","</div>","</li>",""].join("\n")),a["SCBone/track"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>',"<header>",'<a href="<%- prefix %>tracks/<%- id %>" class="title"><%- title %></a>','<span class="duration"><i class="icon-clock"></i><%- moment(duration).format("m:s") %></span>','<span class="likes"><i class="icon-heart"></i><%- favoritings_count %></span>','<span class="user">','<a href="<%- prefix %>users/<%- user.permalink %>" class="username"><%- user.username %></a>','<span class="full-name"><%- user.full_name %></span>',"</span>",'<% if (typeof label !== "undefined") { %>','<span class="label">','<a href="<%- prefix %>users/<%- label.permalink %>" class="username"><%- label.username %></a>','<span class="full-name"><%- label.full_name %></span>',"</span>","<% } %>","</header>",'<div class="description"><%= description %></div>',"<footer>","</footer>",""].join("\n")),"undefined"!=typeof window&&window.JST&&_.defaults(window.JST,a),a}),function(a){"object"==typeof exports?module.exports=a(require("backbone")):"function"==typeof define&&define.amd&&define("mixins",["backbone"],a)}(function(Backbone){function a(a){a=a||{};var b=this,d=a.success||c,e=a.error||c,f=b.get("permalink")||b.id,g="/"+_.result(b,"url")+"/"+f;if(!a.subresource)return SC.get(g,function(a,c){b.set(a),d.call(b,a,c)}),void 0;g=g+"/"+a.subresource;var h=b.constructor.subresources,i=h[a.subresource];if(!i)throw new Error("No subresource found for"+a.subresource);require([i],function(c){var e=b[a.subresource];e||(e=b[a.subresource]=new c,b.listenTo(e,"change",function(){b.trigger("change:"+a.subresource,b,{subresource:a.subresource}),b.trigger("change",b,{subresource:a.subresource})})),SC.get(g,function(a,c){var f=_.isUndefined(b.length)?"set":"reset";e[f](a,{silent:!0}),e.trigger("change",e,{}),d.call(b,a,c)})},e)}function b(a){return function(b,d,e){e=e||{};var f,g=e.success||c,h=(e.error||c,d instanceof Backbone.Model),i=h?d.idAttribute:d.model.prototype.idAttribute,j=a+":";switch(j+=h?d.id?d.id:"#"+d.cid:"keys",b){case"create":case"update":case"patch":h?localStorage.setItem(j,JSON.stringify(d.toJSON())):(f=d.pluck(i).join(","),localStorage.setItem(j,f),d.each(function(a){a.sync("update",a,{})}));break;case"read":if(h)g(JSON.parse(localStorage.getItem(j)));else{f=(localStorage.getItem(j)||"").split(",");var k=_.compact(_.map(f,function(b){return b&&"c"!==b.substr(0,1)?JSON.parse(localStorage.getItem(a+":"+b)):void 0}));d.reset(k,{silent:!0})}break;case"delete":localStorage.removeItem(j)}}}var c=function(){},d={fetch:a,localSync:b};return d}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../mixins")):"function"==typeof define&&define.amd&&define("models/base-model",["underscore","backbone","./../mixins"],a)}(function(_,Backbone,a){var b=Backbone.Model.extend({fetch:a.fetch},{subresources:{}});return b}),function(a){"object"==typeof exports?module.exports=a(require("./base-model")):"function"==typeof define&&define.amd&&define("models/user",["./base-model"],a)}(function(a){var b=a.extend({url:"users"},{subresources:{comments:"collections/comments",favorites:"collections/tracks",tracks:"collections/tracks",followings:"collections/users",followers:"collections/users"}});return b}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../models/user")):"function"==typeof define&&define.amd&&define("collections/users",["underscore","backbone","./../models/user"],a)}(function(_,Backbone,a){var b=Backbone.Collection.extend({model:a});return b}),function(a){"object"==typeof exports?module.exports=a(require("./base-model")):"function"==typeof define&&define.amd&&define("models/track",["./base-model"],a)}(function(a){var b=a.extend({url:"tracks"},{subresources:{user:"models/user",favoriters:"collections/users",comments:"collections/comments"}});return b}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../models/track")):"function"==typeof define&&define.amd&&define("collections/tracks",["underscore","backbone","./../models/track"],a)}(function(_,Backbone,a){var b=Backbone.Collection.extend({model:a,initialize:function(a,b){b=b||{},this.current=!1},setCurrent:function(a){if(a=parseInt(a||0,10),this.current===a&&a!==!1)return this;this.current=a;var b;return this.each(function(c,d){var e=c.get("current");e&&d!==a?c.set("current",!1):e||d!==a||c.set("current",!0),d===a&&(b=c.id)}),this.trigger("current-track",this,a,b),this},setCurrentById:function(a){return this.setCurrent(this.indexById(a))},indexById:function(a){var b=!1;return this.each(function(c,d){b===!1&&c.id===a&&(b=d)}),b},getCurrent:function(){return this.at(this.current)},previous:function(){return this.current>0?this.setCurrent(this.current-1):this.setCurrent(this.length-1)},next:function(){return this.current>=this.length-1?this.setCurrent(0):this.setCurrent(this.current+1)}});return b}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./tracks"),require("./../models/track")):"function"==typeof define&&define.amd&&define("collections/local-playlist",["underscore","backbone","./tracks","./../models/track","./../mixins"],a)}(function(_,Backbone,a,b,c){var d=function(){},e=b.extend({initialize:function(){this.fetch()},fetch:Backbone.Model.prototype.fetch,sync:c?c.localSync("local-playlist"):d}),f=a.extend({sync:c?c.localSync("local-playlist"):d,model:e,initialize:function(){this.on("sort add remove reset",function(){this.save({silent:!0})}),this.load()},save:function(a){return this.sync("update",this,a),this},load:function(a){return this.sync("read",this,a),this}});return f}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../templates")):"function"==typeof define&&define.amd&&define("views/profile",["underscore","backbone","./../templates"],a)}(function(_,Backbone,a){var b=Backbone.View.extend({events:{"click .sc-connect":"connect"},connect:function(a){return this.router.scConnect(),a?!1:void 0},initialize:function(a){a=a||{},this.routePrefix=a.routePrefix||"",this.listenTo(this.model,"change",this.render)},render:function(){var b={};return b.host=this.model.toJSON(),b.routePrefix=this.routePrefix,this.$el.html(a["SCBone/profile"](b)),this}});return b}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../templates"),require("./../collection/local-playlist")):"function"==typeof define&&define.amd&&define("views/tracks",["underscore","backbone","./../templates","./../collections/local-playlist"],a)}(function(_,Backbone,a,b){var c=Backbone.View.extend({tagName:"ol",className:"tracks-list",events:{'click [data-action="remove"]':"removeTrack",'click [data-action="add"]':"addTrack"},initialize:function(a){a=a||{},this.playlist=a.playlist||this.collection,this.routePrefix=a.routePrefix,this.listenTo(this.collection,"change reset add remove",this.render)},removeTrack:function(a){var b=Backbone.$(a.target).attr("data-id"),c=this.playlist.get(b);return c&&this.playlist.remove(c),!1},addTrack:function(a){var b=Backbone.$(a.target).attr("data-id"),c=this.collection.get(b);return console.info("add track to playlist",b,c,this.playlist!==this.collection),c&&this.playlist.add(c.toJSON()),!1},render:function(c){c=c||{};var d=this,e=d.collection,f=e instanceof b,g=e.map(function(b){var c=b.toJSON();return c.routePrefix=d.routePrefix,c.removeable=f,a["SCBone/trackItem"](c)});return d.undelegateEvents().$el.html(g.join("")),d.delegateEvents(),d}});return c}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../templates"),require("./tracks"),require("moment")):"function"==typeof define&&define.amd&&define("views/player",["underscore","backbone","./../templates","./tracks","moment"],a)}(function(_,Backbone,a,b){var c=Backbone.$,d=Backbone.View.extend({events:{"click .progress":"playPause","click .prev":"previousTrack","click .next":"nextTrack","click .tracks .title a":"playTrack","click .js-remove":"removeTrack","click .modal .underlay":"modalClose","click .tracks likes":"like"},initialize:function(d){var e=this;d=d||{},e.routePrefix=d.routePrefix||"",e.sound=null,e.trackId=null,e.listenTo(e.collection,"current-track",function(a,b,d){if(e.trackId!==d){e.trackId=d,d&&e.drawProgress().trigger("current-track",d),e.$(".tracks li").removeClass("current").eq(b).addClass("current");var f=46*Math.max(0,b-1)+8*Math.max(0,b-1);c.fn.scrollTo?e.$(".tracks").scrollTo(f):e.$(".tracks")[0].scrollTop=f}}),e.on("current-track",function(a){var b=e.collection.get(a);e.artwork=!1;var c=b.get("artwork_url");if(c){var d=new Image;d.onload=function(){e.artwork=d,e.drawProgress()},d.src=c}SC.stream("/tracks/"+a,function(a){e.sound&&e.sound.destruct(),e.sound=a,a.play({onfinish:function(){e.nextTrack()},whileplaying:function(){a.playState&&e.drawProgress(a.position/b.get("duration")*100)}})}),e.render()}),e.$el.html(a["SCBone/player"]({currentTrack:{},routePrefix:this.routePrefix})),e.$canvas=c("<canvas />"),e.$(".progress").append(e.$canvas),e.ctx=e.$canvas[0].getContext("2d"),e.tracks=new b({el:e.$(".tracks ol")[0],collection:e.collection,routePrefix:e.routePrefix}),e.tracks.render()},playPause:function(a){var b,c=this.collection.getCurrent();if(a&&a.offsetX&&a.offsetY){var d=this.$("canvas");if(d.length){var e=d[0].width,f=d[0].height;b=a.offsetX>=e/2-17&&a.offsetX<=e/2+17&&a.offsetY>=f/2-17&&a.offsetY<=f/2+17}}if(this.sound){if(b){var g=this.$(".progress");this.sound.paused?(this.sound.play(),g.addClass("playing")):(this.sound.pause(),g.removeClass("playing"))}}else c&&this.trigger("current-track",c.id);return a?!1:this},playTrack:function(a){if(a){var b=c(a.target).attr("href").split("/").pop();return b=parseInt(b,10),this.setCurrentById(b),!1}},removeTrack:function(a){var b=c("a",a.target.parentNode).attr("href").split("/").pop();b=parseInt(b,10);var d=this.collection.get(b);this.collection.remove([d])},getCurrent:function(){return this.collection.getCurrent()},setCurrent:function(a){return this.collection.setCurrent(a)},setCurrentById:function(a){return this.setCurrent(this.indexById(a))},indexById:function(a){return this.collection.indexById(a)},previousTrack:function(a){return this.collection.previous(),a?!1:this},nextTrack:function(a){return this.collection.next(),a?!1:this},drawProgress:function(a){function b(){var a=h/2,b=g/2;f.fillStyle=k,f.beginPath(),f.moveTo(b-6,a-12),f.lineTo(b+8,a),f.lineTo(b-6,a+12),f.lineTo(b-6,a-12),f.closePath(),f.fill()}function c(){var a=h/2,b=g/2;f.fillStyle=k,f.fillRect(b-9,a-9,6,18),f.fillRect(b+3,a-9,6,18)}if(this.sound&&!this.sound.playState)return this;a=a||0;Math.round(100*a);a=3.6*a;var d=this.$("canvas");if(!d.length)return this;var e=this.$(".progress"),f=d[0].getContext("2d"),g=d[0].width=Math.min(e.width(),200),h=d[0].height=Math.min(e.height(),200);if(!g||!h)return this;var i=0,j="rgba(255, 255, 255, 0.4)",k="rgba(0, 0, 0, 0.8)";return this.artwork&&f.drawImage(this.artwork,i,i,g-2*i,h-2*i),f.beginPath(),f.lineWidth=32,f.strokeStyle=j,f.arc(.5*g,.5*h,(Math.min(g,h)-64)/2,0,Math.PI/180*360),f.stroke(),f.closePath(),this.sound&&(f.beginPath(),f.lineWidth=16,f.strokeStyle=k,f.arc(.5*g,.5*h,(Math.min(g,h)-64)/2,Math.PI/180*-90,Math.PI/180*(a-90)),f.stroke(),f.closePath()),f.fillStyle=j,f.fillRect(g/2-17,h/2-17,34,34),!this.sound||this.sound.paused?(e.removeClass("playing"),b()):(e.addClass("playing"),c()),this},render:function(b){b=b||{};var c=this.getCurrent();return this.$(".controls").html(a["SCBone/controls"]({currentTrack:c?c.toJSON():{},routePrefix:this.routePrefix})),this.drawProgress(),this.tracks.render(),this},modal:function(a){return this.$modal=this.$(".modal"),this.$modal.length||(this.$modal=c('<div class="modal"><div class="underlay"></div><div class="content"></div></div>'),this.$el.append(this.$modal)),this.$modal.find(".content").addClass("open").empty()[_.isString(a)?"html":"append"](a),this},modalAsk:function(){var a=c();return this.modal(a)},modalClose:function(){return this.$modal.removeClass("open"),this}});return d}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),require("./../templates")):"function"==typeof define&&define.amd&&define("views/user",["underscore","backbone","./../templates"],a)}(function(_,Backbone,a){var b=Backbone.View.extend({events:{},initialize:function(a){a=a||{},this.routePrefix=a.routePrefix||{},this.listenTo(this.model,"change",this.render)},render:function(){var b="";if(this.model.id){var c=this.model.toJSON();c.routePrefix=this.routePrefix,b=a["SCBone/user"](c)}return this.$el.html(b),this}});return b}),function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone"),null,require("./templates"),require("./collections/users"),require("./collections/tracks"),require("./views/profile"),require("./templates/player"),require("./templates/user"),require("./templates/tracks")):"function"==typeof define&&define.amd?define("scbone",["underscore","backbone","//connect.soundcloud.com/sdk.js","./templates","./collections/users","./collections/tracks","./collections/local-playlist","./views/profile","./views/player","./views/user","./views/tracks"],a):"undefined"!=typeof _&&"undefined"!=typeof Backbone&&(window.SCBone=a(_,Backbone))}(function(_,Backbone,a,b,c,d,e,f,g,h,i){function j(a){a&&localStorage.setItem("scbone-access-token",a);var b=localStorage.getItem("scbone-access-token");return b}var k,l=Backbone.$,m=c.prototype.model,n=(d.prototype.model,"host-tracks"),o="guest-tracks guest-users host-tracks host-users",p=Backbone.Router.extend({routePrefix:"step/sounds",routes:{"":"appStart","users/:id(/:subresource)":"usersAction","host/:subresource":"hostAction","tracks/:id":"playTrack",connect:"scConnect"},appStart:function(){},playTrack:function(a){a=parseInt(a,10);var b=this,c=this.player.collection;c.get(a)?this.player.setCurrentById(a):SC.get("/tracks/"+a,function(d){c.add(d),b.playTrack(a),b.player.playPause()})},hostAction:function(a){this.host.once("change:"+a,function(){var b="host-tracks";"followings"===a||"followers"===a?b="host-users":this.tracks.collection.reset(this.host[a].toJSON()),this.scope(b)},this),this.host.fetch({subresource:a})},usersAction:function(a,b){var c=this.guest;b&&c.once("change:"+b,function(){var a="guest-tracks";"followings"===b||"followers"===b?a="guest-users":this.tracks.collection.reset(c[b].toJSON()),this.scope(a)},this),c.id!==a?(c.attributes={},c.attributes[c.idAttribute]=a,c.id=a,c.fetch({success:function(){b&&c.fetch({subresource:b})}})):b&&c.fetch({subresource:b})},scConnect:function(){var a=this;if(!k){k=!0;var b=j();b?(SC.accessToken(b),a.scConnected()):SC.connect(function(){j(SC.accessToken()),a.scConnected()})}},scConnected:function(){var a=this;SC.get("/me",function(b){a.guest.set(a.host.toJSON()),a.host.set(b),a.host.once("change:favorites",function(){a.player.collection.set(a.host.favorites.toJSON()),a.player.collection.setCurrent(0),a.player.tracksRender()}),a.host.fetch({subresource:"favorites"}),a.player.render()})},scIsConnected:function(){return!!SC.accessToken()},scope:function(a){return a&&n!==a&&(n=a,this.$el.removeClass(o),a&&this.$el.addClass(a)),n},initialize:function(a){var c=this;if(c.el=a.el,c.$el=l(c.el),c.routePrefix=a.routePrefix||"",c.$el.addClass(n),!a.hostpermalink)throw new Error("A `hostpermalink` option must be set.");if(!a.el)throw new Error("A `el` (DOM element) option must be set.");if(!a.clientid)throw new Error("A `clientid` option must be set.");var j='[href^="/"]';a.routePrefix&&(j='[href^="'+a.routePrefix+'"],[href^="/'+a.routePrefix+'"],[href^="#'+a.routePrefix+'"]'),l(document).delegate(j,"click",function(){var a=l(this).attr("href"),b=a.substr(0,1);return a="/"===b||"#"===b?a.substr(1):a,c.navigate(a,{trigger:!0}),!1}),SC.initialize({client_id:a.clientid,redirect_uri:a.callbackurl}),c.localPlaylist=new e([],{}),c.host=new m({permalink:a.hostpermalink}),c.guest=new m({}),l(c.el).html(b["SCBone/app"],{routePrefix:c.routePrefix}),c.profile=new f({model:c.host,el:l(".host",a.el)[0],router:c}),c.profile.render(),c.player=new g({el:l(".player",a.el)[0],collection:c.localPlaylist,router:c}),c.tracks=new i({el:l(".scope.tracks")[0],collection:new d,playlist:c.localPlaylist}),c.user=new h({el:l(".user",a.el)[0],model:c.guest,router:c}),c.user.render(),c.host.fetch({}),c.localPlaylist.load().length?c.player.render():(c.host.once("change:favorites",function(a){c.localPlaylist.reset(a.favorites.toJSON(),{silent:!0}),c.localPlaylist.save(),c.player.render()}),c.host.fetch({subresource:"favorites"}))}});return p});