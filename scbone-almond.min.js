/*! scbone - v0.0.1 - 2013-11-12 */
!function(){var a,b,c;!function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=s.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[];if(f=f||a,"function"==typeof c){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c.apply(q[a],u),a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){return"string"==typeof a?p[a]?p[a](b):j(o(a,b).f):(a.splice||(s=a,b.splice?(a=b,b=c,c=null):a=d),b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n)},n.config=function(a){return s=a,s.deps&&n(s.deps,s.callback),n},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../bower_components/almond/almond",function(){}),function(a){"object"==typeof exports?module.exports=a(b("underscore")):"function"==typeof c&&c.amd?c("templates",["underscore"],a):"function"!=typeof _&&(window.JST=a(_))}(function(_){var a={};return a["SCBone/profile"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="block-h">','<a href="<%- prefix %>host" class="picture">','<img src="<%- host.avatar_url %>" alt="<%- host.username %>" />',"</a>",'<div class="info">','<a href="<%- prefix %>host" class="username"><%- host.username %></a>','<span class="full-name"><%- host.full_name %></span>','<span class="city"><%- host.city %></span><%= (host.country && host.city ? "," : "") %>','<span class="country"><%- host.country %></span>',"</div>","</div>",'<ul class="subresources">',"<li>",'<%= (host.public_favorites_count ? "<a href=\\""+ prefix +"host/favorites\\">" : "<div>") %>','<i class="icon-heart"></i>','<span><%- (host.public_favorites_count || "") %></span>',"Likes",'<%= (host.public_favorites_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.track_count ? "<a href=\\""+ prefix +"host/tracks\\">" : "<div>") %>','<i class="icon-mic"></i>',"<span><%- (host.track_count || 0) %></span>","Tracks",'<%= (host.track_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.followings_count ? "<a href=\\""+ prefix +"host/followings\\">" : "<div>") %>','<i class="icon-angle-left"></i>',"<span><%- (host.followings_count || 0) %></span>","Followings",'<%= (host.followings_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (host.followers_count ? "<a href=\\""+ prefix +"host/followers\\">" : "<div>") %>','<i class="icon-angle-right"></i>',"<span><%- (host.followers_count || 0) %></span>","Followers",'<%= (host.followers_count ? "</a>" : "</div>") %>',"</li>","</ul>",'<div class="description"><%- host.description %></div>',""].join("\n")),a["SCBone/user"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="block-h">','<a href="<%- prefix %>users/<%- permalink %>" class="picture">','<img src="<%- avatar_url %>" alt="<%- username %>" />',"</a>",'<div class="info">','<a href="<%- prefix %>users/<%- permalink %>" class="username"><%- username %></a>','<span class="full-name"><%- full_name %></span>','<span class="city"><%- city %></span><%= (country && city ? "," : "") %>','<span class="country"><%- country %></span>',"</div>","</div>",'<ul class="subresources">',"<li>",'<%= (public_favorites_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/favorites\\">" : "<div>") %>','<i class="icon-heart"></i>','<span><%- (public_favorites_count || "") %></span>',"Likes",'<%= (public_favorites_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (track_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/tracks\\">" : "<div>") %>','<i class="icon-mic"></i>',"<span><%- (track_count || 0) %></span>","Tracks",'<%= (track_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (followings_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/followings\\">" : "<div>") %>','<i class="icon-angle-left"></i>',"<span><%- (followings_count || 0) %></span>","Followings",'<%= (followings_count ? "</a>" : "</div>") %>',"</li>","<li>",'<%= (followers_count ? "<a href=\\""+ prefix +"users/"+ permalink +"/followers\\">" : "<div>") %>','<i class="icon-angle-right"></i>',"<span><%- (followers_count || 0) %></span>","Followers",'<%= (followers_count ? "</a>" : "</div>") %>',"</li>","</ul>",'<div class="description"><%- description %></div>',""].join("\n")),a["SCBone/app"]=_.template(["",'<div class="host-sc-profile host"></div>','<div class="scope player"></div>','<div class="scope user"></div>','<div class="scope group"></div>','<div class="scope host-tracks"></div>','<div class="scope host-users"></div>',""].join("\n")),a["SCBone/player"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="progress"></div>','<div class="controls"></div>','<div class="logos">','<a class="soundcloud" href="http://soundcloud.com" title="powered by Soundcloud"><img src="images/logo_big_white.png" alt="powered by Soundcloud" /></a>',"</div>",'<section class="list tracks"><ol></ol></section>',""].join("\n")),a["SCBone/controls"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<div class="playback">','<button class="prev icon-prev"><i class="icon-angle-double-left"></i></button>','<button class="next icon-next"><i class="icon-angle-double-right"></i></button>',"</div>",""].join("\n")),a["SCBone/trackItem"]=_.template(["","<%",'var prefix = "#"+ (routePrefix ? routePrefix +"/" : "");','var likes = (typeof favoritings_count !== "undefined" ? favoritings_count : 0);','var user_liked = (typeof user_favorite !== "undefined" && user_favorite);','var removeable = (typeof removeable !== "undefined" && removeable);',"%>",'<li<%= (artwork_url ? "" : " class=\\"no-artwork\\"") %>>',"<% if(artwork_url) { %>",'<img class="artwork" src="<%- artwork_url %>">',"<% } %>",'<div class="track-info <%- sharing %>">','<div class="title">',"<% if (removeable) { %>",'<i class="icon-minus js-remove"></i>',"<% } %>",'<a href="<%- prefix %>tracks/<%- id %>"><%- title %></a>',"</div>",'<span class="duration">','<i class="icon-clock"></i>','<%- moment(duration).format("m:s") %>',"</span>",'<span class="likes"','<%= (user_liked ? " title=\\"You liked it.\\"" : "") %>',">",'<i class="icon-heart<%- (user_liked ? "" : "-empty") %>"></i>',"<%- likes %>","</span>",'<a href="<%- prefix %>users/<%- user.permalink %>" class="username">',"<%- user.username %>","</a>",'<% if (sharing === "private") { %>',"<% } %>","</div>","</li>",""].join("\n")),a["SCBone/userItem"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>','<li<%= (artwork_url ? "" : " class=\\"no-artwork\\"") %>>',"<% if(artwork_url) { %>",'<img class="artwork" src="<%- artwork_url %>">',"<% } %>",'<div class="track-info">','<div class="title">','<a href="<%- prefix %>tracks/<%- id %>"><%- title %></a>',"</div>",'<span class="duration">','<i class="icon-clock"></i>','<%- moment(duration).format("m:s") %>',"</span>",'<% if(typeof favoritings_count !== "undefined") { %>','<span class="favorited"><%- favoritings_count %></span>',"<% } %>",'<a href="<%- prefix %>users/<%- user.permalink %>" class="username">',"<%- user.username %>","</a>","</div>","</li>",""].join("\n")),a["SCBone/track"]=_.template(["",'<% var prefix = "#"+ (routePrefix ? routePrefix +"/" : ""); %>',"<header>",'<a href="<%- prefix %>tracks/<%- id %>" class="title"><%- title %></a>','<span class="duration"><i class="icon-clock"></i><%- moment(duration).format("m:s") %></span>','<span class="likes"><i class="icon-heart"></i><%- favoritings_count %></span>','<span class="user">','<a href="<%- prefix %>users/<%- user.permalink %>" class="username"><%- user.username %></a>','<span class="full-name"><%- user.full_name %></span>',"</span>",'<% if (typeof label !== "undefined") { %>','<span class="label">','<a href="<%- prefix %>users/<%- label.permalink %>" class="username"><%- label.username %></a>','<span class="full-name"><%- label.full_name %></span>',"</span>","<% } %>","</header>",'<div class="description"><%= description %></div>',"<footer>","</footer>",""].join("\n")),"undefined"!=typeof window&&window.JST&&_.defaults(window.JST,a),a}),function(a){"object"==typeof exports?module.exports=a(b("backbone")):"function"==typeof c&&c.amd&&c("mixins",["backbone"],a)}(function(Backbone){function a(a){a=a||{};var c=this,e=a.success||d,f=a.error||d,g=c.get("permalink")||c.id,h="/"+_.result(c,"url")+"/"+g;if(!a.subresource)return SC.get(h,function(a,b){c.set(a),e.call(c,a,b)}),void 0;h=h+"/"+a.subresource;var i=c.constructor.subresources,j=i[a.subresource];if(!j)throw new Error("No subresource found for"+a.subresource);b([j],function(b){var d=c[a.subresource];d||(d=c[a.subresource]=new b,c.listenTo(d,"change",function(){c.trigger("change:"+a.subresource,c,{subresource:a.subresource}),c.trigger("change",c,{subresource:a.subresource})})),SC.get(h,function(a,b){var f=_.isUndefined(c.length)?"set":"reset";d[f](a,{silent:!0}),d.trigger("change",d,{}),e.call(c,a,b)})},f)}function c(a){return function(b,c,e){var f=e.success||d,g=(e.error||d,c instanceof Backbone.Model),h=a+":";switch(h+=g?c.id?c.id:"#"+c.cid:"keys",b){case"create":case"update":case"patch":g?localStorage.setItem(h,JSON.stringify(c.toJSON())):(localStorage.setItem(h,_.keys(c._byId).join(",")),c.each(function(a){a.sync("update",a,{})}));break;case"read":if(g)f(JSON.parse(localStorage.getItem(h)));else{var i=(c.model.prototype.idAttribute,(localStorage.getItem(h)||"").split(",")),j=_.compact(_.map(i,function(b){return b&&"c"!==b.substr(0,1)?JSON.parse(localStorage.getItem(a+":"+b)):void 0}));c.reset(j)}break;case"delete":}}}var d=function(){},e={fetch:a,localSync:c};return e}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../mixins")):"function"==typeof c&&c.amd&&c("models/base-model",["underscore","backbone","./../mixins"],a)}(function(_,Backbone,a){var b=Backbone.Model.extend({fetch:a.fetch},{subresources:{}});return b}),function(a){"object"==typeof exports?module.exports=a(b("./base-model")):"function"==typeof c&&c.amd&&c("models/user",["./base-model"],a)}(function(a){var b=a.extend({url:"users"},{subresources:{comments:"collections/comments",favorites:"collections/tracks",tracks:"collections/tracks",followings:"collections/users",followers:"collections/users"}});return b}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../models/user")):"function"==typeof c&&c.amd&&c("collections/users",["underscore","backbone","./../models/user"],a)}(function(_,Backbone,a){var b=Backbone.Collection.extend({model:a});return b}),function(a){"object"==typeof exports?module.exports=a(b("./base-model")):"function"==typeof c&&c.amd&&c("models/track",["./base-model"],a)}(function(a){var b=a.extend({url:"tracks"},{subresources:{user:"models/user",favoriters:"collections/users",comments:"collections/comments"}});return b}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../models/track")):"function"==typeof c&&c.amd&&c("collections/tracks",["underscore","backbone","./../models/track"],a)}(function(_,Backbone,a){var b=Backbone.Collection.extend({model:a,initialize:function(a,b){b=b||{},this.current=!1},setCurrent:function(a){if(a=parseInt(a||0,10),this.current===a&&a!==!1)return this;this.current=a;var b;return this.each(function(c,d){var e=c.get("current");e&&d!==a?c.set("current",!1):e||d!==a||c.set("current",!0),d===a&&(b=c.id)}),this.trigger("current-track",this,a,b),this},setCurrentById:function(a){return this.setCurrent(this.indexById(a))},indexById:function(a){var b=!1;return this.each(function(c,d){b===!1&&c.id===a&&(b=d)}),b},getCurrent:function(){return this.at(this.current)},previous:function(){return this.current>0?this.setCurrent(this.current-1):this.setCurrent(this.length-1)},next:function(){return this.current>=this.length-1?this.setCurrent(0):this.setCurrent(this.current+1)}});return b}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./tracks"),b("./../models/track")):"function"==typeof c&&c.amd&&c("collections/local-playlist",["underscore","backbone","./tracks","./../models/track","./../mixins"],a)}(function(_,Backbone,a,b,c){var d=function(){},e=b.extend({initialize:function(){this.fetch()},fetch:Backbone.Model.prototype.fetch,sync:c?c.localSync("local-playlist"):d}),f=a.extend({sync:c?c.localSync("local-playlist"):d,model:e,initialize:function(){this.on("sort add remove",function(){this.sync("update",this,{silent:!0})}),this.sync("read",this,{})}});return f}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../templates")):"function"==typeof c&&c.amd&&c("views/profile",["underscore","backbone","./../templates"],a)}(function(_,Backbone,a){var b=Backbone.View.extend({events:{"click .sc-connect":"connect"},connect:function(a){return this.router.scConnect(),a?!1:void 0},initialize:function(a){this.router=a.router,this.listenTo(this.model,"change",this.render)},render:function(){var b={};return b.host=this.model.toJSON(),b.routePrefix=this.router.routePrefix,this.$el.html(a["SCBone/profile"](b)),this}});return b}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../templates"),b("./../collection/local-playlist")):"function"==typeof c&&c.amd&&c("views/tracks",["underscore","backbone","./../templates","./../collections/local-playlist"],a)}(function(_,Backbone,a,b){var c=Backbone.View.extend({tagName:"ol",className:"tracks-list",events:{},initialize:function(a){this.router=a.router,this.listenTo(this.collection,"change reset add remove",this.render)},render:function(c){c=c||{};var d=this,e=this.collection instanceof b,f=c.collection||d.collection,g=f.map(function(b){var c=b.toJSON();return c.routePrefix=d.router.routePrefix,c.removeable=e,a["SCBone/trackItem"](c)});return d.undelegateEvents().$el.html(g.join("")),d.delegateEvents(),d}});return c}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../templates"),b("./tracks"),b("moment")):"function"==typeof c&&c.amd&&c("views/player",["underscore","backbone","./../templates","./tracks","moment"],a)}(function(_,Backbone,a,b){var c=Backbone.$,d=Backbone.View.extend({events:{"click .progress":"playPause","click .prev":"previousTrack","click .next":"nextTrack","click .tracks .title a":"playTrack","click .js-remove":"removeTrack","click .modal .underlay":"modalClose","click .tracks likes":"like"},initialize:function(d){var e=this;e.router=d.router,e.sound=null,e.trackId=null,e.listenTo(e.collection,"current-track",function(a,b,d){if(e.trackId!==d){e.trackId=d,d&&e.drawProgress().trigger("current-track",d),e.$(".tracks li").removeClass("current").eq(b).addClass("current");var f=46*Math.max(0,b-1)+8*Math.max(0,b-1);c.fn.scrollTo?e.$(".tracks").scrollTo(f):e.$(".tracks")[0].scrollTop=f}}),e.on("current-track",function(a){var b=e.collection.get(a);e.artwork=!1;var c=b.get("artwork_url");if(c){var d=new Image;d.onload=function(){e.artwork=d,e.drawProgress()},d.src=c}SC.stream("/tracks/"+a,function(a){e.sound&&e.sound.destruct(),e.sound=a,a.play({onfinish:function(){e.nextTrack()},whileplaying:function(){a.playState&&e.drawProgress(a.position/b.get("duration")*100)}})}),e.render()}),e.$el.html(a["SCBone/player"]({currentTrack:{},routePrefix:this.router.routePrefix})),e.$canvas=c("<canvas />"),e.$(".progress").append(e.$canvas),e.ctx=e.$canvas[0].getContext("2d"),e.tracks=new b({el:e.$(".tracks ol")[0],collection:e.collection,router:e.router}),e.tracks.render()},playPause:function(a){var b,c=this.collection.getCurrent();if(a&&a.offsetX&&a.offsetY){var d=this.$("canvas");if(d.length){var e=d[0].width,f=d[0].height;b=a.offsetX>=e/2-17&&a.offsetX<=e/2+17&&a.offsetY>=f/2-17&&a.offsetY<=f/2+17}}if(this.sound){if(b){var g=this.$(".progress");this.sound.paused?(this.sound.play(),g.addClass("playing")):(this.sound.pause(),g.removeClass("playing"))}}else c&&this.trigger("current-track",c.id);return a?!1:this},playTrack:function(a){if(a){var b=c(a.target).attr("href").split("/").pop();return b=parseInt(b,10),this.setCurrentById(b),!1}},removeTrack:function(a){var b=c("a",a.target.parentNode).attr("href").split("/").pop();b=parseInt(b,10);var d=this.collection.get(b);this.collection.remove([d])},getCurrent:function(){return this.collection.getCurrent()},setCurrent:function(a){return this.collection.setCurrent(a)},setCurrentById:function(a){return this.setCurrent(this.indexById(a))},indexById:function(a){return this.collection.indexById(a)},previousTrack:function(a){return this.collection.previous(),a?!1:this},nextTrack:function(a){return this.collection.next(),a?!1:this},drawProgress:function(a){function b(){var a=h/2,b=g/2;f.fillStyle=k,f.beginPath(),f.moveTo(b-6,a-12),f.lineTo(b+8,a),f.lineTo(b-6,a+12),f.lineTo(b-6,a-12),f.closePath(),f.fill()}function c(){var a=h/2,b=g/2;f.fillStyle=k,f.fillRect(b-9,a-9,6,18),f.fillRect(b+3,a-9,6,18)}if(this.sound&&!this.sound.playState)return this;a=a||0;Math.round(100*a);a=3.6*a;var d=this.$("canvas");if(!d.length)return this;var e=this.$(".progress"),f=d[0].getContext("2d"),g=d[0].width=Math.min(e.width(),200),h=d[0].height=Math.min(e.height(),200);if(!g||!h)return this;var i=0,j="rgba(255, 255, 255, 0.4)",k="rgba(0, 0, 0, 0.8)";return this.artwork&&f.drawImage(this.artwork,i,i,g-2*i,h-2*i),f.beginPath(),f.lineWidth=32,f.strokeStyle=j,f.arc(.5*g,.5*h,(Math.min(g,h)-64)/2,0,Math.PI/180*360),f.stroke(),f.closePath(),this.sound&&(f.beginPath(),f.lineWidth=16,f.strokeStyle=k,f.arc(.5*g,.5*h,(Math.min(g,h)-64)/2,Math.PI/180*-90,Math.PI/180*(a-90)),f.stroke(),f.closePath()),f.fillStyle=j,f.fillRect(g/2-17,h/2-17,34,34),!this.sound||this.sound.paused?(e.removeClass("playing"),b()):(e.addClass("playing"),c()),this},render:function(b){b=b||{};var c=this.getCurrent();return this.$(".controls").html(a["SCBone/controls"]({currentTrack:c?c.toJSON():{},routePrefix:this.router.routePrefix})),this.drawProgress(),b.scope&&_.isFunction(this[b.scope+"Render"])&&this[b.scope+"Render"](b),this},tracksRender:function(a){a=a||{};var b=this;return b.tracks.render(),b},usersRender:function(b){b=b||{};var c=this;if(b.collection){var d=b.collection.map(function(b){var d=b.toJSON();return d.routePrefix=c.router.routePrefix,a["SCBone/userItem"](d)});c.$(".users ul").html(d.join(""))}return c},modal:function(a){return this.$modal=this.$(".modal"),this.$modal.length||(this.$modal=c('<div class="modal"><div class="underlay"></div><div class="content"></div></div>'),this.$el.append(this.$modal)),this.$modal.find(".content").addClass("open").empty()[_.isString(a)?"html":"append"](a),this},modalAsk:function(){var a=c();return this.modal(a)},modalClose:function(){return this.$modal.removeClass("open"),this}});return d}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),b("./../templates")):"function"==typeof c&&c.amd&&c("views/user",["underscore","backbone","./../templates"],a)}(function(_,Backbone,a){var b=Backbone.View.extend({events:{},initialize:function(a){this.router=a.router,this.listenTo(this.model,"change",this.render)},render:function(){var b="";if(this.model.id){var c=this.model.toJSON();c.routePrefix=this.router.routePrefix,b=a["SCBone/user"](c)}return this.$el.html(b),this}});return b}),function(a){"object"==typeof exports?module.exports=a(b("underscore"),b("backbone"),null,b("./templates"),b("./collections/users"),b("./collections/tracks"),b("./views/profile"),b("./templates/player"),b("./templates/user")):"function"==typeof c&&c.amd?c("scbone",["underscore","backbone","//connect.soundcloud.com/sdk.js","./templates","./collections/users","./collections/tracks","./collections/local-playlist","./views/profile","./views/player","./views/user"],a):"undefined"!=typeof _&&"undefined"!=typeof Backbone&&(window.SCBone=a(_,Backbone))}(function(_,Backbone,a,b,c,d,e,f,g,h){function i(a){a&&localStorage.setItem("scbone-access-token",a);var b=localStorage.getItem("scbone-access-token");return b}var j,k=Backbone.$,l=c.prototype.model,m=d.prototype.model,n="track user comment group followers followings tracks users comments groups host-tracks host-users",o=Backbone.Router.extend({routePrefix:"step/sounds",routes:{"":"appStart","users/:id(/:subresource)":"usersAction","host/:subresource":"hostAction","tracks/:id":"playTrack",connect:"scConnect"},appStart:function(){},playTrack:function(a){a=parseInt(a,10);var b=this,c=this.player.collection;c.get(a)?this.player.setCurrentById(a):SC.get("/tracks/"+a,function(d){c.add(d),b.playTrack(a),b.player.playPause()})},hostAction:function(a){this.host.fetch({subresource:a})},usersAction:function(a,b){var c=this.guest;this.setScope("user"),c.id!==a?(c.attributes={},c.attributes[c.idAttribute]=a,c.id=a,c.fetch({success:function(){b&&c.fetch({subresource:b})}})):b&&c.fetch({subresource:b})},scConnect:function(){var a=this;if(!j){j=!0;var b=i();b?(SC.accessToken(b),a.scConnected()):SC.connect(function(){i(SC.accessToken()),a.scConnected()})}},scConnected:function(){var a=this;SC.get("/me",function(b){a.guest.set(a.host.toJSON()),a.host.set(b),a.host.once("change:favorites",function(){a.player.collection.set(a.host.favorites.toJSON()),a.player.collection.setCurrent(0),a.player.tracksRender()}),a.host.fetch({subresource:"favorites"}),a.player.render()})},scIsConnected:function(){return!!i()},setScope:function(a){return this.$el.removeClass(n),a&&this.$el.addClass(a),this},initialize:function(a){var c=this;if(c.el=a.el,c.$el=k(c.el),c.routePrefix=a.routePrefix||"",!a.hostpermalink)throw new Error("A `hostpermalink` option must be set.");if(!a.el)throw new Error("A `el` (DOM element) option must be set.");var d='[href^="/"]';a.routePrefix&&(d='[href^="'+a.routePrefix+'"],[href^="/'+a.routePrefix+'"],[href^="#'+a.routePrefix+'"]'),k(document).delegate(d,"click",function(){var a=k(this).attr("href"),b=a.substr(0,1);return a="/"===b||"#"===b?a.substr(1):a,c.navigate(a,{trigger:!0}),!1}),SC.initialize({client_id:a.clientid,redirect_uri:a.callbackurl}),c.localPlaylist=new e([],{}),c.host=new l({permalink:a.hostpermalink}),c.listenTo(c.host,"change:favorites",function(a){c.localPlaylist.length||(c.localPlaylist.add(a.favorites.toJSON()),c.localPlaylist.sync("update",c.localPlaylist,{}))}),k(c.el).html(b["SCBone/app"],{routePrefix:c.routePrefix}),c.profile=new f({model:c.host,el:k(".host-sc-profile",a.el)[0],router:c}),c.profile.render(),c.player=new g({el:k(".player",a.el)[0],collection:c.localPlaylist,router:c}),c.guest=new l({}),c.user=new h({el:k(".user",a.el)[0],model:c.guest,router:c}),c.user.render(),c.localPlaylist.fetch(),c.host.fetch({})}},{Models:{User:l,Track:m},Collections:{User:c,Track:d,LocalPlaylist:e},Views:{Profile:f}});return o})}();